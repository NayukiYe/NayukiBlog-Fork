---
interface Tag {
  tag: string;
  count: number;
}

interface Props {
  tags: Tag[];
}

const { tags } = Astro.props;

const maxCount = Math.max(...tags.map(t => t.count));
const minCount = Math.min(...tags.map(t => t.count));

const getTagSize = (count: number) => {
  const minSize = 0.85;
  const maxSize = 1.3;
  if (maxCount === minCount) return minSize;
  return minSize + ((count - minCount) / (maxCount - minCount)) * (maxSize - minSize);
};
---

<aside class="sidebar-right">
  <div class="sidebar-title">标签</div>
  <div class="tags-box">
    <button class="tag-btn active" data-tag="" style="font-size: 1rem">全部</button>
    {tags.map(({ tag, count }) => (
      <button 
        class="tag-btn" 
        data-tag={tag}
        style={`font-size: ${getTagSize(count)}rem`}
        title={`${count} posts`}
      >
        {tag}
      </button>
    ))}
  </div>
</aside>

<style>
  .sidebar-right {
    position: sticky;
    top: 2rem;
    height: calc(100vh - 4rem);
    overflow-y: auto;
    padding-bottom: 2rem;
  }

  .sidebar-title {
    font-size: 0.85rem;
    font-weight: 700;
    color: #999;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 1rem;
    padding-left: 0.5rem;
  }

  .tags-box {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    align-content: flex-start;
    align-items: center;
    padding-right: 0.5rem;
  }

  /* Custom Scrollbar */
  .sidebar-right::-webkit-scrollbar {
    width: 4px;
  }
  .sidebar-right::-webkit-scrollbar-track {
    background: transparent;
  }
  .sidebar-right::-webkit-scrollbar-thumb {
    background: #eee;
    border-radius: 4px;
  }
  .sidebar-right:hover::-webkit-scrollbar-thumb {
    background: #ddd;
  }

  .tag-btn {
    padding: 0.4em 0.8em;
    border: 1px solid transparent;
    border-radius: 2em;
    background-color: #f5f5f5;
    color: #555;
    cursor: pointer;
    transition: all 0.2s ease;
    line-height: 1;
  }
  .tag-btn:hover {
    background-color: #e0e0e0;
    color: #000;
    transform: translateY(-1px);
  }
  .tag-btn.active {
    background-color: #000;
    color: #fff;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  @media (max-width: 900px) {
    .sidebar-right {
      position: static;
      height: auto;
      width: 100%;
      overflow-y: visible;
    }
    .tags-box {
      max-height: 300px;
      overflow-y: auto;
    }
  }
</style>