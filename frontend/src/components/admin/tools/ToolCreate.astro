---
// ToolCreate.astro
---

<div class="create-card">
  <div class="card-header">
    <h3 class="card-title">New Tool</h3>
  </div>

  <form id="create-tool-form" class="create-form">
    <!-- Icon URL -->
    <div class="form-row">
      <div class="form-group icon-group">
        <label>Icon URL</label>
        <input type="url" name="icon" class="form-input" placeholder="https://example.com/icon.png">
      </div>
    </div>

    <!-- Name & Description -->
    <div class="form-row">
      <div class="form-group name-group">
        <label>Name</label>
        <input type="text" name="name" required class="form-input" placeholder="Tool Name">
      </div>
      <div class="form-group desc-group">
        <label>Description</label>
        <input type="text" name="description" class="form-input" placeholder="Short description...">
      </div>
    </div>

    <!-- URL -->
    <div class="form-row">
      <div class="form-group url-group">
        <label>Tool URL</label>
        <input type="url" name="url" required class="form-input" placeholder="https://tool-link.com">
      </div>
    </div>

    <!-- Category & Status -->
    <div class="form-row">
      <div class="form-group category-group">
        <label>Category</label>
        <input type="text" name="category" class="form-input" placeholder="Add Category">
      </div>

      <div class="form-group status-group">
        <label>Status</label>
        <div class="custom-select-wrapper" id="createStatusWrapper">
          <div class="custom-select-trigger" id="createStatusTrigger">
            <span class="current-text">Published</span>
            <input type="hidden" name="status" value="published">
            <svg class="arrow-icon" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
          </div>
          <div class="custom-options hidden" id="createStatusOptions">
            <div class="custom-option selected" data-value="published">Published</div>
            <div class="custom-option" data-value="draft">Draft</div>
            <div class="custom-option" data-value="archived">Archived</div>
          </div>
        </div>
      </div>
    </div>

    <div class="form-footer">
      <button type="submit" class="btn-submit">
        <i class="fas fa-plus"></i> Add Tool
      </button>
    </div>
  </form>
</div>

<style>
  .create-card {
    background: #fff;
    border-radius: 8px;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    border: 1px solid #eee;
    height: 450px; /* Fixed height to match filter */
    display: flex;
    flex-direction: column;
    gap: 1rem;
    box-sizing: border-box;
  }

  .card-header {
    padding-bottom: 0.8rem;
    border-bottom: 1px solid #eee;
    margin-bottom: 0.5rem;
  }

  .card-title {
    font-size: 0.75rem;
    font-weight: 600;
    color: #333;
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .create-form {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
    flex: 1;
    overflow-y: auto;
  }

  .form-row {
    display: flex;
    gap: 1rem;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
    flex: 1;
  }

  .name-group { flex: 1; }
  .desc-group { flex: 2; }
  .category-group { flex: 3; }
  .status-group { flex: 1; }

  label {
    font-size: 0.8rem;
    color: #666;
    font-weight: 500;
  }

  .form-input {
    padding: 0.5rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 0.85rem;
    width: 100%;
    box-sizing: border-box;
    height: 36px;
    font-family: inherit;
  }

  .form-input:focus {
    border-color: #000;
    outline: none;
  }

  /* Custom Select */
  .custom-select-wrapper {
    position: relative;
    width: 100%;
  }

  .custom-select-trigger {
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 0 0.6rem;
    cursor: pointer;
    background: #fff;
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 36px;
    font-size: 0.85rem;
    color: #333;
    box-sizing: border-box;
  }

  .custom-options {
    position: absolute;
    bottom: 100%;
    left: 0;
    right: 0;
    background: #fff;
    border: 1px solid #eee;
    border-radius: 4px;
    z-index: 100;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    margin-bottom: 4px;
  }

  .custom-options.hidden { display: none; }

  .custom-option {
    padding: 8px 12px;
    cursor: pointer;
    font-size: 0.85rem;
    color: #444;
  }

  .custom-option:hover { background: #f5f5f7; }
  .custom-option.selected { background: #f0f7ff; color: #0066cc; }

  .form-footer {
    margin-top: auto;
    display: flex;
    justify-content: flex-end;
  }

  .btn-submit {
    background: #000;
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    font-size: 0.85rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .btn-submit:hover {
    background: #333;
  }
</style>

<script>
  // Status Dropdown
  const statusWrapper = document.getElementById('createStatusWrapper');
  const statusTrigger = document.getElementById('createStatusTrigger');
  const statusOptions = document.getElementById('createStatusOptions');
  const statusInput = statusWrapper?.querySelector('input');
  const statusText = statusWrapper?.querySelector('.current-text');

  statusTrigger?.addEventListener('click', (e) => {
    e.stopPropagation();
    statusOptions?.classList.toggle('hidden');
  });

  statusOptions?.addEventListener('click', (e) => {
    const target = e.target as HTMLElement;
    if (target.classList.contains('custom-option')) {
      const value = target.getAttribute('data-value');
      const text = target.textContent;
      
      statusOptions.querySelectorAll('.custom-option').forEach(opt => opt.classList.remove('selected'));
      target.classList.add('selected');
      
      if (statusText) statusText.textContent = text;
      if (statusInput) statusInput.value = value || '';
      
      statusOptions.classList.add('hidden');
    }
  });

  document.addEventListener('click', (e) => {
    if (!statusWrapper?.contains(e.target as Node)) {
      statusOptions?.classList.add('hidden');
    }
  });

  // Form Submit
  const form = document.getElementById('create-tool-form') as HTMLFormElement;
  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    // TODO: Implement API call
    alert('Tool creation logic to be implemented');
  });
</script>
