---
import PageLayout from '../../layouts/PageLayout.astro';
import BookCard from '../../components/User/BookCard.astro';
import { apiUrl } from '../../lib/api';
// import booksData from '../data/books.json';

interface Book {
  title: string;
  cover: string;
  url: string;
  status: string;
  rating: number;
  tags: string[];
}

let books: Book[] = [];
try {
  const response = await fetch(apiUrl('/api/user/books'));
  if (response.ok) {
    books = await response.json() as Book[];
  } else {
    console.error(`Failed to fetch books: ${response.status} ${response.statusText}`);
  }
} catch (error) {
  console.error('Failed to fetch books:', error);
}
---

<PageLayout title="Library | Nayuki Blog">
  <div class="container">
    <h1 class="page-title">图书馆</h1>
    <p class="page-desc">我的阅读清单与书籍收藏。</p>
    
    <div class="books-grid">
      {books.map((book) => (
        <BookCard 
          title={book.title} 
          cover={book.cover} 
          tags={book.tags}
          url={book.url}
        />
      ))}
    </div>
  </div>
</PageLayout>

<style>
  .container { max-width: 1000px; margin: 0 auto; }
  .page-title { font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem; }
  .page-desc { color: #666; margin-bottom: 3rem; }

  .books-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
  }

  @media (min-width: 640px) {
    .books-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .books-grid {
      grid-template-columns: repeat(4, 1fr);
    }
  }
</style>
