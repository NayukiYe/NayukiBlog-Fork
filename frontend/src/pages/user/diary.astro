---
import PageLayout from '../../layouts/PageLayout.astro';
import DiaryCard from '../../components/User/DiaryCard.astro';

interface Diary {
  date: string;
  content: string;
  mood: string;
  weather: string;
  images: string[];
}

let diaries: Diary[] = [];
try {
  const response = await fetch('http://127.0.0.1:8000/api/diaries');
  if (response.ok) {
    diaries = await response.json() as Diary[];
  } else {
    console.error(`Failed to fetch diaries: ${response.status} ${response.statusText}`);
  }
} catch (error) {
  console.error('Failed to fetch diaries:', error);
}

// Sort diaries by date descending
diaries = diaries.sort((a, b) => new Date(b.date).valueOf() - new Date(a.date).valueOf());
---

<PageLayout title="Diary | Nayuki Blog">
  <div class="container">
    <h1 class="page-title">ðŸ“” ä¸ªäººæ—¥è®°</h1>
    <p class="page-desc">è®°å½•ç”Ÿæ´»ç‚¹æ»´ä¸Žç¢Žç¢Žå¿µã€‚</p>
    
    <div class="timeline">
      {diaries.map((diary) => (
        <DiaryCard {...diary} />
      ))}
    </div>
  </div>
</PageLayout>

<style>
  .container { max-width: 800px; margin: 0 auto; }
  .page-title { font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem; }
  .page-desc { color: #666; margin-bottom: 3rem; }

  /* Timeline Styles */
  .timeline {
    position: relative;
    padding-left: 2rem;
    border-left: 2px solid #eee;
    margin-left: 1rem;
  }
</style>
